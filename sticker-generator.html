<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreezeTrack - Sticker Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            padding: 1rem;
        }

        .header {
            background: #2563eb;
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .controls {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        input, select {
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        button {
            background: #2563eb;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #1e40af;
        }

        button.secondary {
            background: #10b981;
        }

        button.secondary:hover {
            background: #059669;
        }

        button.danger {
            background: #ef4444;
        }

        button.danger:hover {
            background: #dc2626;
        }

        .sticker-sheet {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .sticker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .sticker {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            background: #f9fafb;
            page-break-inside: avoid;
        }

        .sticker.qr {
            background: white;
        }

        .sticker.qr canvas {
            max-width: 100%;
            height: auto;
        }

        .sticker-info {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .sticker-id {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .sticker-short {
            font-family: monospace;
            background: #e0e7ff;
            color: #3730a3;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .print-controls {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }

        .print-info {
            background: #e0e7ff;
            color: #3730a3;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .print-info h3 {
            margin-bottom: 0.5rem;
        }

        .print-info ul {
            margin-left: 1.5rem;
        }

        .print-info li {
            margin-bottom: 0.25rem;
        }

        @media print {
            body { background: white; }
            .header, .controls, .print-controls { display: none; }
            .sticker-sheet { box-shadow: none; }
            .sticker { break-inside: avoid; }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .sticker-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üßä FreezeTrack Sticker Generator</h1>
        <p>Erstellen Sie vorbereitete QR-Code-Sticker f√ºr Ihre Tiefk√ºhlware</p>
    </div>

    <div class="controls">
        <h2>‚öôÔ∏è Sticker-Konfiguration</h2>
        
        <div class="form-grid">
                            <div class="form-group">
                    <label for="stickerType">Sticker-Typ:</label>
                    <select id="stickerType">
                        <option value="ITM">Artikel (ITM:UUID)</option>
                        <option value="CUSTOM">Benutzerdefiniert (PREFIX:UUID)</option>
                    </select>
                </div>

            <div class="form-group">
                <label for="stickerCount">Anzahl Sticker:</label>
                <input type="number" id="stickerCount" value="20" min="1" max="100">
            </div>

            <div class="form-group">
                <label for="stickerSize">Sticker-Gr√∂√üe:</label>
                <select id="stickerSize">
                    <option value="small">Klein (20x20mm)</option>
                    <option value="medium" selected>Mittel (30x30mm)</option>
                    <option value="large">Gro√ü (40x40mm)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="stickerFormat">Format:</label>
                <select id="stickerFormat">
                    <option value="uuid">UUID (zuf√§llig)</option>
                    <option value="sequential">Sequentiell (001, 002, ...)</option>
                    <option value="date">Datum + Sequenz</option>
                    <option value="custom">Benutzerdefiniert</option>
                </select>
            </div>

            <div class="form-group">
                <label for="customPrefix">Benutzerdefinierter Pr√§fix:</label>
                <input type="text" id="customPrefix" placeholder="z.B. TK, FOOD, ITEM" value="ITM">
            </div>

            <div class="form-group">
                <label for="startNumber">Startnummer (f√ºr sequentielle):</label>
                <input type="number" id="startNumber" value="1" min="1">
            </div>
        </div>

        <div class="button-group">
            <button onclick="generateStickers()">üéØ Sticker generieren</button>
            <button class="secondary" onclick="generateRandomBatch()">üé≤ Zuf√§llige Sticker</button>
            <button class="secondary" onclick="generateSequentialBatch()">üî¢ Sequenzielle Sticker</button>
            <button class="danger" onclick="clearStickers()">üóëÔ∏è Alle l√∂schen</button>
        </div>

        <div class="print-info">
            <h3>üìã Druckhinweise</h3>
            <ul>
                <li><strong>Etikettenmaterial:</strong> Gefrierfeste PP/Polyester-Etiketten mit TK-Kleber</li>
                <li><strong>Gr√∂√üe:</strong> W√§hlen Sie die passende Sticker-Gr√∂√üe f√ºr Ihren Drucker</li>
                <li><strong>Layout:</strong> Sticker werden automatisch f√ºr A4-Druck optimiert</li>
                <li><strong>QR-Code:</strong> Mindestens 20x20mm f√ºr gute Scannbarkeit</li>
            </ul>
        </div>
    </div>

    <div class="sticker-sheet">
        <h2>üìÑ Sticker-Bogen</h2>
        <div class="print-controls">
            <button onclick="window.print()">üñ®Ô∏è Drucken</button>
            <button onclick="downloadAllStickers()">üíæ Alle herunterladen</button>
            <button onclick="exportStickerList()">üìä Liste exportieren</button>
        </div>
        
        <div id="stickerContainer" class="sticker-grid">
            <div class="sticker">
                <p>Klicken Sie auf "Sticker generieren" um zu beginnen</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        let currentStickers = [];
        let stickerCounter = 1;

        // Sticker-Typen und deren Standard-Pr√§fixe
        const stickerTypes = {
            'ITM': { prefix: 'ITM', description: 'Artikel' },
            'CUSTOM': { prefix: 'CUSTOM', description: 'Benutzerdefiniert' }
        };

        // Sticker-Gr√∂√üen in Pixeln
        const stickerSizes = {
            'small': 128,
            'medium': 192,
            'large': 256
        };

        function generateStickers() {
            const type = document.getElementById('stickerType').value;
            const count = parseInt(document.getElementById('stickerCount').value);
            const format = document.getElementById('stickerFormat').value;
            const customPrefix = document.getElementById('customPrefix').value;
            const startNumber = parseInt(document.getElementById('startNumber').value);

            if (count < 1 || count > 100) {
                alert('Bitte w√§hlen Sie eine Anzahl zwischen 1 und 100');
                return;
            }

            currentStickers = [];
            const container = document.getElementById('stickerContainer');
            container.innerHTML = '';

            for (let i = 0; i < count; i++) {
                let id;
                let shortId;

                switch (format) {
                    case 'uuid':
                        id = generateUUID(customPrefix);
                        shortId = id.slice(-5);
                        break;
                    case 'sequential':
                        id = `${customPrefix}:${String(startNumber + i).padStart(3, '0')}`;
                        shortId = String(startNumber + i).padStart(3, '0');
                        break;
                    case 'date':
                        const today = new Date();
                        const dateStr = today.toISOString().slice(0, 10).replace(/-/g, '');
                        id = `${customPrefix}:${dateStr}-${String(startNumber + i).padStart(3, '0')}`;
                        shortId = String(startNumber + i).padStart(3, '0');
                        break;
                    case 'custom':
                        id = `${customPrefix}:${generateCustomId()}`;
                        shortId = id.slice(-5);
                        break;
                }

                currentStickers.push({ id, shortId, type: stickerTypes[type].description });
                createStickerElement(id, shortId, type);
            }

            updateStickerCounter();
        }

        function generateRandomBatch() {
            document.getElementById('stickerFormat').value = 'uuid';
            document.getElementById('stickerCount').value = 20;
            generateStickers();
        }

        function generateSequentialBatch() {
            document.getElementById('stickerFormat').value = 'sequential';
            document.getElementById('stickerCount').value = 50;
            document.getElementById('startNumber').value = 1;
            generateStickers();
        }

        function createStickerElement(id, shortId, type) {
            const container = document.getElementById('stickerContainer');
            const stickerDiv = document.createElement('div');
            stickerDiv.className = 'sticker qr';
            
            const size = stickerSizes[document.getElementById('stickerSize').value];
            
            stickerDiv.innerHTML = `
                <div class="sticker-id">${type}</div>
                <div class="sticker-short">${shortId}</div>
                <div id="qr-${id.replace(/:/g, '-')}"></div>
                <div class="sticker-info">
                    <div>${id}</div>
                    <small>Gr√∂√üe: ${size}px</small>
                </div>
            `;
            
            container.appendChild(stickerDiv);

            // QR-Code generieren - direkte SVG-Generierung
            const qrContainer = document.getElementById(`qr-${id.replace(/:/g, '-')}`);
            if (qrContainer) {
                generateSVGSticker(qrContainer, id, size);
            }
        }

        function generateSVGSticker(container, text, size) {
            console.log('Generiere SVG QR-Code f√ºr Sticker:', text, 'Gr√∂√üe:', size);
            
            // Direkte SVG-Generierung ohne Callback
            try {
                const qrSvg = QRCode.toString(text, {
                    type: 'svg',
                    width: size,
                    height: size,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                });
                
                if (qrSvg && typeof qrSvg === 'string') {
                    console.log('SVG QR-Code erfolgreich generiert');
                    container.innerHTML = qrSvg;
                } else {
                    throw new Error('QRCode.toString gab kein g√ºltiges SVG zur√ºck');
                }
            } catch (error) {
                console.error('SVG QR-Code Generierung fehlgeschlagen:', error);
                
                // Fallback: Einfacher Text-basierter QR-Code
                const fallbackQR = generateTextBasedQR(text, size);
                container.innerHTML = fallbackQR;
            }
        }

        function generateTextBasedQR(text, size) {
            // Einfacher Fallback: Text in einem stilisierten Container
            return `
                <div style="
                    width: ${size}px; 
                    height: ${size}px; 
                    background: #000; 
                    color: #fff; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    font-family: monospace; 
                    font-size: ${Math.max(8, size/20)}px; 
                    text-align: center; 
                    padding: 8px;
                    border-radius: 4px;
                ">
                    <div>
                        <div style="font-weight: bold; margin-bottom: 4px;">QR</div>
                        <div style="font-size: ${Math.max(6, size/25)}px;">${text.slice(-8)}</div>
                    </div>
                </div>
            `;
        }

        function generateUUID(prefix) {
            return `${prefix}:${crypto.randomUUID()}`;
        }

        function generateCustomId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function clearStickers() {
            currentStickers = [];
            document.getElementById('stickerContainer').innerHTML = `
                <div class="sticker">
                    <p>Alle Sticker gel√∂scht</p>
                </div>
            `;
            updateStickerCounter();
        }

        function updateStickerCounter() {
            stickerCounter = currentStickers.length;
        }

        function downloadAllStickers() {
            if (currentStickers.length === 0) {
                alert('Keine Sticker zum Herunterladen vorhanden');
                return;
            }

            // Alle Sticker als ZIP herunterladen (vereinfachte Version)
            alert('Download-Funktion: Alle Sticker werden als einzelne PNG-Dateien heruntergeladen');
            
            currentStickers.forEach((sticker, index) => {
                const canvas = document.querySelector(`#qr-${sticker.id.replace(/:/g, '-')} canvas`);
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = `sticker-${sticker.shortId}-${index + 1}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                }
            });
        }

        function exportStickerList() {
            if (currentStickers.length === 0) {
                alert('Keine Sticker zum Exportieren vorhanden');
                return;
            }

            const csvContent = [
                ['Nummer', 'ID', 'Kurz-ID', 'Typ', 'Generiert am'],
                ...currentStickers.map((sticker, index) => [
                    index + 1,
                    sticker.id,
                    sticker.shortId,
                    sticker.type,
                    new Date().toISOString()
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `sticker-liste-${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
        }

        // Event-Listener f√ºr dynamische Updates
        document.getElementById('stickerType').addEventListener('change', function() {
            const type = this.value;
            const prefixInput = document.getElementById('customPrefix');
            if (stickerTypes[type]) {
                prefixInput.value = stickerTypes[type].prefix;
            }
        });

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            // Standardwerte setzen
            document.getElementById('stickerType').value = 'ITM';
            document.getElementById('customPrefix').value = 'ITM';
            document.getElementById('stickerFormat').value = 'uuid';
            document.getElementById('stickerCount').value = 20;
            document.getElementById('startNumber').value = 1;
        });
    </script>
</body>
</html>
