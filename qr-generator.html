<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreezeTrack - QR-Code Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            padding: 1rem;
        }

        .header {
            background: #2563eb;
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .controls {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        input, select {
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        button {
            background: #2563eb;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #1e40af;
        }

        button.secondary {
            background: #10b981;
        }

        button.secondary:hover {
            background: #059669;
        }

        button.danger {
            background: #ef4444;
        }

        button.danger:hover {
            background: #dc2626;
        }

        .qr-container {
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .qr-code {
            margin: 1rem 0;
        }

        .qr-code canvas, .qr-code svg {
            max-width: 100%;
            height: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .download-section {
            margin-top: 2rem;
            text-align: center;
        }

        .info {
            background: #e0e7ff;
            color: #3730a3;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .info h3 {
            margin-bottom: 0.5rem;
        }

        .info ul {
            margin-left: 1.5rem;
        }

        .info li {
            margin-bottom: 0.25rem;
        }

        .generated-info {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
        }

        .generated-info strong {
            color: #1f2937;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üßä FreezeTrack QR-Code Generator</h1>
        <p>Generieren Sie eindeutige QR-Codes f√ºr Ihre Tiefk√ºhlware</p>
    </div>

    <div class="info">
        <h3>üìã Wichtiger Hinweis</h3>
        <ul>
            <li><strong>QR-Codes enthalten nur eindeutige IDs</strong> (z.B. ITM:01H9ABCDEFGHIJKLMNOP)</li>
            <li><strong>Alle anderen Informationen</strong> (Name, Kategorie, Ort, MHD) werden in der App gespeichert</li>
            <li><strong>Jeder QR-Code ist einzigartig</strong> und kann nicht dupliziert werden</li>
            <li><strong>Verwenden Sie diese IDs</strong> als "Fingerabdruck" f√ºr Ihre Artikel</li>
        </ul>
    </div>

    <div class="controls">
        <h2>‚öôÔ∏è QR-Code Konfiguration</h2>
        
        <form id="qrForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="qrType">QR-Code Typ:</label>
                    <select id="qrType">
                        <option value="ITM">Artikel (ITM:...)</option>
                        <option value="LOC">Lagerort (LOC:...)</option>
                        <option value="CAT">Kategorie (CAT:...)</option>
                        <option value="CUSTOM">Benutzerdefiniert</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="customPrefix">Benutzerdefinierter Pr√§fix:</label>
                    <input type="text" id="customPrefix" placeholder="z.B. TK, FOOD, ITEM" value="ITM">
                </div>

                <div class="form-group">
                    <label for="qrFormat">Format:</label>
                    <select id="qrFormat">
                        <option value="uuid">UUID (eindeutig, zuf√§llig)</option>
                        <option value="sequential">Sequentiell (001, 002, ...)</option>
                        <option value="timestamp">Zeitstempel + Zufall</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="startNumber">Startnummer (f√ºr sequentielle):</label>
                    <input type="number" id="startNumber" value="1" min="1">
                </div>
            </div>

            <div class="button-group">
                <button type="submit">üéØ QR-Code generieren</button>
                <button type="button" class="secondary" onclick="generateRandomQR()">üé≤ Zuf√§lligen QR-Code</button>
                <button type="button" class="secondary" onclick="generateSequentialQR()">üî¢ Sequentiellen QR-Code</button>
                <button type="button" class="danger" onclick="clearQR()">üóëÔ∏è L√∂schen</button>
            </div>
        </form>
    </div>

    <div id="qrContainer" class="qr-container" style="display: none;">
        <h3>Generierter QR-Code</h3>
        <div id="qrCode" class="qr-code"></div>
        
        <div class="generated-info">
            <p><strong>Vollst√§ndige ID:</strong> <span id="generatedId"></span></p>
            <p><strong>Kurz-ID:</strong> <span id="shortId"></span></p>
            <p><strong>Typ:</strong> <span id="generatedType"></span></p>
            <p><strong>Generiert am:</strong> <span id="generatedDate"></span></p>
        </div>
        
        <div class="download-section">
            <button onclick="downloadQR()">üíæ QR-Code herunterladen</button>
            <button onclick="printQR()">üñ®Ô∏è QR-Code drucken</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        let currentQRData = null;
        let sequentialCounter = 1;

        // Event-Listener f√ºr dynamische Updates
        document.getElementById('qrType').addEventListener('change', function() {
            const type = this.value;
            const prefixInput = document.getElementById('customPrefix');
            if (type === 'ITM') prefixInput.value = 'ITM';
            else if (type === 'LOC') prefixInput.value = 'LOC';
            else if (type === 'CAT') prefixInput.value = 'CAT';
        });

        function generateUUID(prefix) {
            return `${prefix}:${crypto.randomUUID()}`;
        }

        function generateSequential(prefix, startNumber) {
            const number = startNumber + sequentialCounter - 1;
            sequentialCounter++;
            return `${prefix}:${String(number).padStart(6, '0')}`;
        }

        function generateTimestamp(prefix) {
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(2, 8);
            return `${prefix}:${timestamp}-${random}`;
        }

        function generateQR() {
            const type = document.getElementById('qrType').value;
            const format = document.getElementById('qrFormat').value;
            const customPrefix = document.getElementById('customPrefix').value;
            const startNumber = parseInt(document.getElementById('startNumber').value);

            let id;
            let shortId;

            switch (format) {
                case 'uuid':
                    id = generateUUID(customPrefix);
                    shortId = id.slice(-8);
                    break;
                case 'sequential':
                    id = generateSequential(customPrefix, startNumber);
                    shortId = id.split(':')[1];
                    break;
                case 'timestamp':
                    id = generateTimestamp(customPrefix);
                    shortId = id.slice(-6);
                    break;
            }

            currentQRData = { id, shortId, type, format };
            displayQR(id, shortId, type);
        }

        function displayQR(id, shortId, type) {
            const container = document.getElementById('qrContainer');
            const qrCodeDiv = document.getElementById('qrCode');
            
            // Container anzeigen
            container.style.display = 'block';
            
            // Informationen setzen
            document.getElementById('generatedId').textContent = id;
            document.getElementById('shortId').textContent = shortId;
            document.getElementById('generatedType').textContent = type;
            document.getElementById('generatedDate').textContent = new Date().toLocaleString('de-DE');
            
            // QR-Code generieren
            qrCodeDiv.innerHTML = '';
            
            try {
                QRCode.toCanvas(qrCodeDiv, id, {
                    width: 256,
                    height: 256,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (error) {
                    if (error) {
                        console.error('Canvas QR-Code Fehler:', error);
                        generateSVGQR(qrCodeDiv, id);
                    } else {
                        console.log('QR-Code erfolgreich generiert (Canvas)');
                    }
                });
            } catch (error) {
                console.error('QR-Code Generierung fehlgeschlagen:', error);
                generateSVGQR(qrCodeDiv, id);
            }
        }

        function generateSVGQR(container, text) {
            console.log('Generiere SVG QR-Code f√ºr:', text);
            try {
                QRCode.toString(text, {
                    type: 'svg',
                    width: 256,
                    height: 256,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (error, string) {
                    if (error) {
                        console.error('SVG QR-Code Fehler:', error);
                        showErrorFallback(container, text);
                    } else {
                        console.log('SVG QR-Code erfolgreich generiert');
                        container.innerHTML = string;
                    }
                });
            } catch (error) {
                console.error('SVG QR-Code Generierung fehlgeschlagen:', error);
                showErrorFallback(container, text);
            }
        }

        function showErrorFallback(container, text) {
            container.innerHTML = `
                <div style="padding: 2rem; text-align: center; background: #f3f4f6; border-radius: 8px;">
                    <h3>QR-Code konnte nicht generiert werden</h3>
                    <p><strong>ID:</strong> ${text}</p>
                    <p><strong>Kurz-ID:</strong> ${text.slice(-8)}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Bitte versuchen Sie es erneut oder laden Sie die Seite neu.</p>
                </div>
            `;
        }

        function generateRandomQR() {
            document.getElementById('qrFormat').value = 'uuid';
            generateQR();
        }

        function generateSequentialQR() {
            document.getElementById('qrFormat').value = 'sequential';
            generateQR();
        }

        function clearQR() {
            document.getElementById('qrContainer').style.display = 'none';
            document.getElementById('qrCode').innerHTML = '';
            currentQRData = null;
            sequentialCounter = 1;
        }

        function downloadQR() {
            if (!currentQRData) {
                alert('Kein QR-Code zum Herunterladen vorhanden');
                return;
            }

            const canvas = document.querySelector('#qrCode canvas');
            const svg = document.querySelector('#qrCode svg');
            
            if (canvas) {
                // Canvas QR-Code herunterladen
                const link = document.createElement('a');
                link.download = `freezetrack-qr-${currentQRData.shortId}.png`;
                link.href = canvas.toDataURL();
                link.click();
            } else if (svg) {
                // SVG QR-Code herunterladen
                const svgData = new XMLSerializer().serializeToString(svg);
                const blob = new Blob([svgData], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `freezetrack-qr-${currentQRData.shortId}.svg`;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
            } else {
                alert('Kein QR-Code zum Herunterladen vorhanden');
            }
        }

        function printQR() {
            if (!currentQRData) {
                alert('Kein QR-Code zum Drucken vorhanden');
                return;
            }

            const canvas = document.querySelector('#qrCode canvas');
            const svg = document.querySelector('#qrCode svg');
            
            if (!canvas && !svg) {
                alert('Kein QR-Code zum Drucken vorhanden');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            
            let qrImageSrc = '';
            if (canvas) {
                qrImageSrc = canvas.toDataURL();
            } else if (svg) {
                const svgData = new XMLSerializer().serializeToString(svg);
                qrImageSrc = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
            }
            
            printWindow.document.write(`
                <html>
                    <head>
                        <title>FreezeTrack QR-Code - ${currentQRData.shortId}</title>
                        <style>
                            body { font-family: Arial, sans-serif; text-align: center; padding: 2rem; }
                            .qr-info { margin: 2rem 0; }
                            .qr-code { margin: 2rem 0; }
                            @media print { body { margin: 0; } }
                        </style>
                    </head>
                    <body>
                        <h1>FreezeTrack QR-Code</h1>
                        <div class="qr-info">
                            <p><strong>Typ:</strong> ${currentQRData.type}</p>
                            <p><strong>ID:</strong> ${currentQRData.id}</p>
                            <p><strong>Kurz-ID:</strong> ${currentQRData.shortId}</p>
                            <p><strong>Format:</strong> ${currentQRData.format}</p>
                        </div>
                        <div class="qr-code">
                            <img src="${qrImageSrc}" width="200" height="200">
                        </div>
                        <p><small>Generiert am ${new Date().toLocaleDateString('de-DE')}</small></p>
                    </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // Formular-Event
        document.getElementById('qrForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generateQR();
        });

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('qrType').value = 'ITM';
            document.getElementById('customPrefix').value = 'ITM';
            document.getElementById('qrFormat').value = 'uuid';
            document.getElementById('startNumber').value = 1;
        });
    </script>
</body>
</html>
